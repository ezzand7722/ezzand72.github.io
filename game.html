<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Interface</title>
    <style>
        body {
            background: linear-gradient(135deg, #1a1a1a, #2a2a2a);
            color: #ffffff;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            font-family: 'Arial', sans-serif;
            overflow: hidden; /* Prevent scrollbars */
            position: relative; /* Allow absolute positioning of the ball */
        }
        .ball {
            position: absolute;
            width: 30px;
            height: 30px;
            background-color: red;
            border-radius: 50%;
            top: 50%; /* Start in the center */
            left: 50%; /* Start in the center */
            transform: translate(-50%, -50%); /* Center the ball */
        }
        .power {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 1.5em;
            color: #ffffff;
            z-index: 100;
        }
        .fme {
            display: none; /* Remove the "F ME" text */
        }
        .platform {
            position: absolute;
            background-color: #00f;
        }
        .lava {
            position: absolute;
            background-color: #f00;
            height: 20px;
        }
        .goal {
            position: absolute;
            background-color: #0f0; /* Changed from blue to green */
            width: 30px;
            height: 100px;
            right: 50px;
            top: 50%;
        }
        .joystick-base {
            position: fixed;
            width: 100px;
            height: 100px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            bottom: 50px;
            right: 50px; /* Positioning to the bottom right */
            z-index: 1000;
        }
        .joystick-stick {
            position: absolute;
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1001;
        }
    </style>
</head>
<body>
    <div class="power" id="power">Power: 0</div> <!-- Power display -->
    <div class="ball" id="ball"></div> <!-- Ball element -->

    <!-- Platforms -->
    <div class="platform" style="width: 300px; height: 20px; left: 200px; top: 300px;"></div>
    <div class="platform" style="width: 100px; height: 20px; right: 200px; top: 250px;"></div>
    <div class="platform" style="width: 150px; height: 20px; right: 300px; top: 350px;"></div>
    <div class="platform" style="width: 200px; height: 20px; left: 45%; top: 60%;"></div>

    <!-- Vertical Walls -->
    <div class="platform" style="width: 20px; height: 200px; left: 400px; top: 200px;"></div>
    <div class="platform" style="width: 20px; height: 150px; right: 350px; top: 300px;"></div>
    <div class="platform" style="width: 20px; height: 250px; left: 600px; top: 150px;"></div>

    <!-- Lava -->
    <div class="lava" style="width: 100%; bottom: 0;"></div>
    <div class="lava" style="width: 20px; height: 100%; left: 0;"></div>

    <!-- Goal -->
    <div class="goal"></div>

    <!-- Always Visible Joystick -->
    <div class="joystick-base" id="joystickBase">
        <div class="joystick-stick" id="joystickStick"></div>
    </div>

    <script>
        const ball = document.getElementById('ball');
        const powerDisplay = document.getElementById('power');
        let ballPosition = { top: window.innerHeight / 2, left: window.innerWidth / 2 }; // Start position
        let velocity = { x: 0, y: 0 }; // Velocity of the ball
        let power = 0; // Power level
        let isLaunching = false; // Flag to check if the ball is launching
        const gravity = 0.2; // Define the gravity value
        const friction = 0.95; // Friction when moving on surfaces (closer to 1 = more slippery)
        const stickiness = 0.5; // How much the ball sticks to surfaces (closer to 0 = stickier)
        const bounceReduction = 0.6; // Reduced bounce factor (was 0.8)

        // Joystick variables
        const joystickBase = document.getElementById('joystickBase');
        const joystickStick = document.getElementById('joystickStick');
        let isJoystickActive = false;
        let joystickCenter = { x: 0, y: 0 };
        let joystickPos = { x: 0, y: 0 };

        // Function to apply gravity to the ball
        function applyGravity() {
            velocity.y += gravity; // Update the vertical velocity with gravity
        }

        // Function to update the ball's position based on velocity
        function updateBallPosition() {
            ballPosition.top += velocity.y;
            ballPosition.left += velocity.x;

            applyGravity();
            checkCollisions();

            // Add air resistance
            velocity.x *= 0.99;

            // Check for collision with the bottom of the screen
            if (ballPosition.top + ball.clientHeight >= window.innerHeight) {
                ballPosition.top = window.innerHeight - ball.clientHeight; // Prevent the ball from going below the screen
                velocity.y = -velocity.y * bounceReduction; // Reduced bounce
            }

            // Update the ball's position
            ball.style.top = ballPosition.top + 'px';
            ball.style.left = ballPosition.left + 'px';
        }

        // Function to update the power display
        function updatePowerDisplay() {
            powerDisplay.textContent = `Power: ${Math.round(power)}`;
        }

        // Joystick control code
        function initJoystick() {
            // Touch start
            joystickBase.addEventListener('touchstart', (e) => {
                isJoystickActive = true;
                const touch = e.touches[0];
                joystickCenter.x = touch.clientX;
                joystickCenter.y = touch.clientY;
                joystickStick.style.transition = 'none'; // Disable transition for smooth movement
            });

            // Touch move
            document.addEventListener('touchmove', (e) => {
                if (!isJoystickActive) return;
                e.preventDefault();
                
                const touch = e.touches[0];
                const dx = touch.clientX - joystickCenter.x;
                const dy = touch.clientY - joystickCenter.y;
                const distance = Math.min(50, Math.sqrt(dx * dx + dy * dy));
                const angle = Math.atan2(dy, dx);
                
                joystickPos.x = distance * Math.cos(angle);
                joystickPos.y = distance * Math.sin(angle);
                
                joystickStick.style.transform = `translate(${joystickPos.x}px, ${joystickPos.y}px)`;
                
                // Update power based on joystick distance
                power = distance * 2;
                updatePowerDisplay();
                
                // Update velocity based on joystick position
                velocity.x = joystickPos.x / 10;
                velocity.y = joystickPos.y / 10;
            });

            // Touch end
            document.addEventListener('touchend', () => {
                if (!isJoystickActive) return;
                isJoystickActive = false;
                joystickStick.style.transform = 'translate(0px, 0px)';
                joystickStick.style.transition = 'transform 0.2s'; // Re-enable transition for smooth return
                
                // Launch the ball when releasing the joystick
                if (power > 0) {
                    launchBall();
                }
            });
        }

        // Update the launchBall function
        function launchBall() {
            isLaunching = true;
            power = Math.max(1, Math.min(100, power));

            // Set velocity based on joystick position
            velocity.x = -joystickPos.x / 5;
            velocity.y = -joystickPos.y / 5;

            // Reset power and joystick
            power = 0;
            joystickPos = { x: 0, y: 0 };
            updatePowerDisplay();

            function animate() {
                if (!isLaunching) return;
                updateBallPosition();
                if (Math.abs(velocity.x) < 0.1 && Math.abs(velocity.y) < 0.1 && 
                    ballPosition.top + ball.clientHeight >= window.innerHeight - 1) {
                    isLaunching = false;
                    return;
                }
                requestAnimationFrame(animate);
            }
            animate();
        }

        // Add collision detection with platforms
        function checkCollisions() {
            const platforms = document.querySelectorAll('.platform');
            const lavas = document.querySelectorAll('.lava');
            const goal = document.querySelector('.goal');

            // Check platform collisions
            platforms.forEach(platform => {
                const rect = platform.getBoundingClientRect();
                if (ballPosition.top + ball.clientHeight > rect.top &&
                    ballPosition.top < rect.bottom &&
                    ballPosition.left + ball.clientWidth > rect.left &&
                    ballPosition.left < rect.right) {
                    // Collision with platform
                    if (velocity.y > 0) {
                        ballPosition.top = rect.top - ball.clientHeight;
                        velocity.y = -velocity.y * bounceReduction; // Reduced bounce
                        velocity.x *= friction; // Apply friction when on platform
                    }
                    // Add stickiness effect
                    if (Math.abs(velocity.y) < 2) {
                        velocity.y *= stickiness;
                    }
                }
            });

            // Check lava collisions
            lavas.forEach(lava => {
                const rect = lava.getBoundingClientRect();
                if (ballPosition.top + ball.clientHeight > rect.top &&
                    ballPosition.top < rect.bottom &&
                    ballPosition.left + ball.clientWidth > rect.left &&
                    ballPosition.left < rect.right) {
                    // Reset the level
                    resetLevel();
                }
            });

            // Check goal collision
            const goalRect = goal.getBoundingClientRect();
            if (ballPosition.top + ball.clientHeight > goalRect.top &&
                ballPosition.top < goalRect.bottom &&
                ballPosition.left + ball.clientWidth > goalRect.left &&
                ballPosition.left < goalRect.right) {
                alert('Level Complete!');
                resetLevel();
            }
        }

        // Function to reset the level
        function resetLevel() {
            ballPosition = { top: window.innerHeight / 2, left: window.innerWidth / 2 };
            velocity = { x: 0, y: 0 };
            power = 0;
            isLaunching = false;
            updateBallPosition();
            updatePowerDisplay();
        }

        // Initialize the ball's position
        updateBallPosition();
        
        // Initialize joystick
        initJoystick();

        // Function to handle joystick movement
        function handleJoystickMove(event) {
            if (isLaunching) return; // Do not move the ball if it's launching

            const joystickBase = document.querySelector('.joystick-base');
            const joystickStick = document.querySelector('.joystick-stick');

            // Calculate the distance from the center of the joystick base
            const deltaX = event.touches[0].clientX - joystickBase.getBoundingClientRect().left - joystickBase.offsetWidth / 2;
            const deltaY = event.touches[0].clientY - joystickBase.getBoundingClientRect().top - joystickBase.offsetHeight / 2;

            // Calculate the angle of the joystick
            let angle = Math.atan2(deltaY, deltaX);
            angle = angle * (180 / Math.PI); // Convert radians to degrees

            // Calculate the distance from the center to the stick
            let distance = Math.min(Math.hypot(deltaX, deltaY), joystickBase.offsetWidth / 2);

            // Move the stick
            joystickStick.style.left = `${Math.cos(angle * (Math.PI / 180)) * distance + joystickBase.offsetWidth / 2 - joystickStick.offsetWidth / 2}px`;
            joystickStick.style.top = `${Math.sin(angle * (Math.PI / 180)) * distance + joystickBase.offsetHeight / 2 - joystickStick.offsetHeight / 2}px`;

            // Update the ball's velocity based on joystick position
            velocity.x = Math.cos(angle * (Math.PI / 180)) * distance / 10; // Adjust the division factor for sensitivity
            velocity.y = Math.sin(angle * (Math.PI / 180)) * distance / 10; // Adjust the division factor for sensitivity
        }

        // Add event listeners for joystick movement
        document.querySelector('.joystick-base').addEventListener('touchmove', handleJoystickMove);
    </script>
</body>
</html>
        
